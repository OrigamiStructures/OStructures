<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>Class App\Controller\Component\EditionStackComponent | StudioManagerScratch</title>

	<link rel="stylesheet" href="resources/bootstrap.min.css?973e37a8502921d56bc02bb55321f45b072b6f71">
	<link rel="stylesheet" href="resources/style.css?49f43d3208c5d7e33fa16d36107a345bf11cc00d">

</head>

<body>
	<nav id="navigation" class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<a href="index.html" class="navbar-brand">StudioManagerScratch</a>
			</div>
			<div class="collapse navbar-collapse">

                <form id="search" class="navbar-form navbar-left" role="search">
                    <input type="hidden" name="cx" value="">
                    <input type="hidden" name="ie" value="UTF-8">
                    <div class="form-group">
                        <input type="text" name="q" class="search-query form-control" placeholder="Search">
					</div>
				</form>

				<ul class="nav navbar-nav">
					<li>
						<a href="namespace-App.Controller.Component.html" title="Summary of App\Controller\Component"><span>Namespace</span></a>
					</li>
					<li class="active">
<span>Class</span>					</li>

					<li class="divider-vertical"></li>


						<li>
							<a href="annotation-group-todo.html" title="List of elements with todo annotation">
								<span>Todo</span>
							</a>
						</li>


				</ul>
			</div>
		</div>
	</nav>

	<div id="left">
	<div id="menu">

		<div id="groups">
				<h3>Namespaces</h3>
			<ul>
					<li class="active">
						<a href="namespace-App.html">
							App<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Cache.html">
							Cache						</a>
							</li>
					<li>
						<a href="namespace-App.Console.html">
							Console						</a>
							</li>
					<li class="active">
						<a href="namespace-App.Controller.html">
							Controller<span></span>
						</a>
							<ul>
					<li class="active">
						<a href="namespace-App.Controller.Component.html">
							Component						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Database.html">
							Database<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Database.Type.html">
							Type						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Exception.html">
							Exception						</a>
							</li>
					<li>
						<a href="namespace-App.Form.html">
							Form						</a>
							</li>
					<li>
						<a href="namespace-App.Lib.html">
							Lib<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Lib.Traits.html">
							Traits						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Model.html">
							Model<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Model.Behavior.html">
							Behavior						</a>
							</li>
					<li>
						<a href="namespace-App.Model.Entity.html">
							Entity<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Model.Entity.EditionSubs.html">
							EditionSubs						</a>
							</li>
					<li>
						<a href="namespace-App.Model.Entity.Traits.html">
							Traits						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Model.Lib.html">
							Lib						</a>
							</li>
					<li>
						<a href="namespace-App.Model.Table.html">
							Table						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Shell.html">
							Shell						</a>
							</li>
					<li>
						<a href="namespace-App.SiteMetrics.html">
							SiteMetrics						</a>
							</li>
					<li>
						<a href="namespace-App.View.html">
							View<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.View.Cell.html">
							Cell						</a>
							</li>
					<li>
						<a href="namespace-App.View.Helper.html">
							Helper<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.View.Helper.Traits.html">
							Traits						</a>
							</li>
								</ul></li></ul></li></ul></li>
			</ul>
		</div>


		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li><a href="class-App.Controller.Component.ArtworkStackComponent.html">ArtworkStackComponent</a></li>
				<li><a href="class-App.Controller.Component.DispositionManagerComponent.html">DispositionManagerComponent</a></li>
				<li class="active"><a href="class-App.Controller.Component.EditionStackComponent.html">EditionStackComponent</a></li>
				<li><a href="class-App.Controller.Component.LayersComponent.html">LayersComponent</a></li>
				<li><a href="class-App.Controller.Component.PieceAllocationComponent.html">PieceAllocationComponent</a></li>
				<li><a href="class-App.Controller.Component.PieceAssignmentComponent.html">PieceAssignmentComponent</a></li>
			</ul>





		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
	<div id="rightInner">
<div id="content" class="class">
	<h1>Class EditionStackComponent</h1>


	<div class="description">
	<p>EditionStackComponent provides a unified interface for the three layers, Edition, Format and Piece</p>

<p>Managing Pieces within Editions and their Formats requires complex data
objects and collections. This component localizes these processes and provides
tools required by the three controllers as they collaborate to maintain
edition content. The actual movement of Pieces across the Edition/Format
layers is passed of to a separate component.</p>
	</div>

	<dl class="tree well">
		<dd style="padding-left:0px">
Cake\Controller\Component
			
			
		</dd>
		<dd style="padding-left:30px">
			<img src="resources/inherit.png" alt="Extended by">
<b><span>App\Controller\Component\EditionStackComponent</span></b>			
			
			 uses 
					<a href="class-App.Lib.Traits.EditionStackCache.html"><span>App\Lib\Traits\EditionStackCache</span></a>
			
		</dd>
	</dl>








	<div class="alert alert-info">
		
		
		<b>Namespace:</b> <a href="namespace-App.html">App</a>\<a href="namespace-App.Controller.html">Controller</a>\<a href="namespace-App.Controller.Component.html">Component</a><br>
		

				<b>Author:</b>
				dondrake<br>
				<b>Todo:</b>
				<p>Exception in this or calling code should clear the edition stack cache, probably
        a special Exception class should be written that takes care of the cache.</p><br>
				<b>Todo:</b>
				<p>This Component seems to mingle PieceTable tasks and AssignmentForm services
The logic of having much of this code in this component is suspect. Many parts
could be in the PieceTable class. The stackQuery() data could be extracted by
and returned from ArtworkStack::stackQuery(); either as optional return data or
through a separate method in that class. And even that Component might be
better as a Model class.</p><br>
			<b>Located at</b> <a href="source-class-App.Controller.Component.EditionStackComponent.html#14-327" title="Go to source code">Controller/Component/EditionStackComponent.php</a>
		<br>
	</div>



		<div class="panel panel-default">
			<div class="panel-heading"><h2>Methods summary</h2></div>
			<table class="summary table table-bordered table-striped methods" id="methods">
		<tr data-order="initialize" id="_initialize">

			<td class="attributes"><code>
				 public 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_initialize">#</a>
			<code><a href="source-class-App.Controller.Component.EditionStackComponent.html#43-47" title="Go to source code">initialize</a>( <span>array <var>$config</var></span> )</code>

			<div class="description short">
				
			</div>

			<div class="description detailed hidden">
				







			</div>
			</div></td>
		</tr>
		<tr data-order="stackQuery" id="_stackQuery">

			<td class="attributes"><code>
				 public 
				tuple
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_stackQuery">#</a>
			<code><a href="source-class-App.Controller.Component.EditionStackComponent.html#49-134" title="Go to source code">stackQuery</a>( )</code>

			<div class="description short">
				<p>Return the object representing an Edition and its contents down through Pieces, and the full Piece set</p>
			</div>

			<div class="description detailed hidden">
				<p>Return the object representing an Edition and its contents down through Pieces, and the full Piece set</p>

<p>The Edition carries its Artwork record for some upstream context.
The Edition and its Formats are returned as siblings, each with its Pieces.
The Pieces are categorized as appropriate to that layer.
The AssignemntTrait on the Edition and Piece entities unify piece access.</p>

<pre><span class="php-comment">// providers array</span>
[<span class="php-quote">'edition'</span> =&gt; EditionEntity {
        ...,
        <span class="php-quote">'unassigned'</span> -&gt; PiecesEntity {},
     },
 <span class="php-num">0</span> =&gt; FormatEntity {
        ...,
        <span class="php-quote">'fluid'</span> -&gt; PiecesEntity {},
     },
 ...
 <span class="php-num">0</span>+n =&gt; FormatEntity {
        ...,
        <span class="php-quote">'fluid'</span> -&gt; PiecesEntity {},
     },
]

<span class="php-comment">// pieces array</span>
[<span class="php-num">0</span> =&gt; PieceEntity {},
...
<span class="php-num">0</span>+n =&gt; PieceEntity {},
]</pre>



					<h4>Returns</h4>
					<div class="list">
						tuple<br>'providers, pieces'
					</div>


					<h4>Todo</h4>
					<div class="list">
							<p>make providers an object?
This would allow it to contain its own ownerTitle hash map. This map
allows piece->key() to lookup its assigned owner's display title.
Currently, redundant code in the elements build the hash. A helper
solution has to return the table as a variable or save it as a property.
but it has difficulty knowing if the property is for the current
version of $providers.</p><br>
					</div>


			</div>
			</div></td>
		</tr>
		<tr data-order="reassignPieces" id="_reassignPieces">

			<td class="attributes"><code>
				 public 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_reassignPieces">#</a>
			<code><a href="source-class-App.Controller.Component.EditionStackComponent.html#136-168" title="Go to source code">reassignPieces</a>( <span>Form <var>$assignment</var></span>, <span>array <var>$providers</var></span> )</code>

			<div class="description short">
				<p>Move the indicated pieces to to indicated destination</p>
			</div>

			<div class="description detailed hidden">
				<p>Move the indicated pieces to to indicated destination</p>

<p>All request inputs were valid and logical we now have the  properties for the edit</p>

<pre>- the set source piece entities (<span class="php-var">$assignment</span>-&gt;source_pieces)
 - an idetifier <span class="php-keyword1">for</span> the destination (<span class="php-var">$assignment</span>-&gt;destination)
 - <span class="php-keyword1">if</span> edition is OPEN
    - the number of pieces to move (<span class="php-var">$assignment</span>-&gt;source_quantity)
 - <span class="php-keyword1">if</span> edition is LIMITED
    - the <span class="php-keyword1">list</span> of piece number to move (<span class="php-var">$assignment</span>-&gt;<span class="php-var">$source_numbers</span>)</pre>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$assignment</var></dt>
						<dd>The Form that gathered and validated the request</dd>
						<dt><var>$providers</var></dt>
						<dd>The oringal list of Edition/Formats and their pieces</dd>
					</dl></div>





			</div>
			</div></td>
		</tr>
		<tr data-order="_prepareNumberedPieces" id="__prepareNumberedPieces">

			<td class="attributes"><code>
				 protected 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#__prepareNumberedPieces">#</a>
			<code><a href="source-class-App.Controller.Component.EditionStackComponent.html#170-198" title="Go to source code">_prepareNumberedPieces</a>( <span><code><a href="class-App.Form.AssignmentForm.html">App\Form\AssignmentForm</a></code> <var>$assignment</var></span>, <span>array <var>$patch</var></span>, <span>array <var>$patch</var>,…</span> )</code>

			<div class="description short">
				
			</div>

			<div class="description detailed hidden">
				


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$assignment</var></dt>
						<dd>The Form that gathered and validated the request</dd>
						<dt><var>$patch</var></dt>
						<dd>$providers The oringal list of Edition/Formats and their pieces</dd>
						<dt><var>$patch</var>,…</dt>
						<dd></dd>
					</dl></div>

					<h4>Returns</h4>
					<div class="list">
						
					</div>




			</div>
			</div></td>
		</tr>
		<tr data-order="_getFormatTriggerPieces" id="__getFormatTriggerPieces">

			<td class="attributes"><code>
				 public 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#__getFormatTriggerPieces">#</a>
			<code><a href="source-class-App.Controller.Component.EditionStackComponent.html#203-219" title="Go to source code">_getFormatTriggerPieces</a>( <span><code><a href="class-App.Form.AssignmentForm.html">App\Form\AssignmentForm</a></code> <var>$assignment</var></span> )</code>

			<div class="description short">
				
			</div>

			<div class="description detailed hidden">
				







			</div>
			</div></td>
		</tr>
		<tr data-order="_prepareOpenPieces" id="__prepareOpenPieces">

			<td class="attributes"><code>
				 protected 
				array
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#__prepareOpenPieces">#</a>
			<code><a href="source-class-App.Controller.Component.EditionStackComponent.html#221-288" title="Go to source code">_prepareOpenPieces</a>( <span>FormObject <var>$assignment</var></span>, <span>array <var>$patch</var></span>, <span>integer <var>$edition_id</var></span> )</code>

			<div class="description short">
				<p>Move a quantity of OpenEdition pieces from source(s) to a destination</p>
			</div>

			<div class="description detailed hidden">
				<p>Move a quantity of OpenEdition pieces from source(s) to a destination</p>

<p>During reassignment multiple sources might be indicated. They will have
avaialble quantity drawn unitl the move request is satisfied</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$assignment</var></dt>
						<dd></dd>
						<dt><var>$patch</var></dt>
						<dd></dd>
						<dt><var>$edition_id</var></dt>
						<dd></dd>
					</dl></div>

					<h4>Returns</h4>
					<div class="list">
						array
					</div>

					<h4>Throws</h4>
					<div class="list">
						Cake\Network\Exception\BadRequestException
					</div>



			</div>
			</div></td>
		</tr>
		<tr data-order="searchExistingPiece" id="_searchExistingPiece">

			<td class="attributes"><code>
				 protected 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_searchExistingPiece">#</a>
			<code><a href="source-class-App.Controller.Component.EditionStackComponent.html#290-292" title="Go to source code">searchExistingPiece</a>( <span> <var>$assignment</var></span> )</code>

			<div class="description short">
				
			</div>

			<div class="description detailed hidden">
				







			</div>
			</div></td>
		</tr>
		<tr data-order="reassignmentTransaction" id="_reassignmentTransaction">

			<td class="attributes"><code>
				 public 
				boolean
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_reassignmentTransaction">#</a>
			<code><a href="source-class-App.Controller.Component.EditionStackComponent.html#294-323" title="Go to source code">reassignmentTransaction</a>( <span>Entity <var>$artwork</var>,…</span>, <span>array <var>$deletions</var>,…</span> )</code>

			<div class="description short">
				<p>Wrap both refinement save and deletions in a single transaction</p>
			</div>

			<div class="description detailed hidden">
				<p>Wrap both refinement save and deletions in a single transaction</p>

<p>Creation is a simple Table->save() but refinement may involve deletion
of piece records. This method provides refinement for all layers of the stack.</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$artwork</var>,…</dt>
						<dd></dd>
						<dt><var>$deletions</var>,…</dt>
						<dd></dd>
					</dl></div>

					<h4>Returns</h4>
					<div class="list">
						boolean
					</div>




			</div>
			</div></td>
		</tr>
			</table>
		</div>


		<div class="panel panel-default">
	        <div class="panel-heading"><h3>Methods used from <a href="class-App.Lib.Traits.EditionStackCache.html#methods">App\Lib\Traits\EditionStackCache</a></h3></div>
			<p class="elementList">
				<code><a href="class-App.Lib.Traits.EditionStackCache.html#_clearCache">clearCache()</a></code>, 
				<code><a href="class-App.Lib.Traits.EditionStackCache.html#_readCache">readCache()</a></code>, 
				<code><a href="class-App.Lib.Traits.EditionStackCache.html#_writeCache">writeCache()</a></code>
			</p>
		</div>









		<div class="panel panel-default">
            <div class="panel-heading"><h2>Properties summary</h2></div>
			<table class="summary table table-bordered table-striped properties" id="properties">
		<tr data-order="pieces_to_save" id="$pieces_to_save">
			<td class="attributes"><code>
				protected  
				
			</code></td>

			<td class="name">
					<a href="source-class-App.Controller.Component.EditionStackComponent.html#39" title="Go to source code"><var>$pieces_to_save</var></a>

				<div class="description short">
					
				</div>

				<div class="description detailed hidden">
					

				</div>
			</td>
			<td class="value">
				<div>
					<a href="#$pieces_to_save" class="anchor">#</a>
					<code></code>
				</div>
			</td>
		</tr>
		<tr data-order="pieces_to_delete" id="$pieces_to_delete">
			<td class="attributes"><code>
				protected  
				
			</code></td>

			<td class="name">
					<a href="source-class-App.Controller.Component.EditionStackComponent.html#40" title="Go to source code"><var>$pieces_to_delete</var></a>

				<div class="description short">
					
				</div>

				<div class="description detailed hidden">
					

				</div>
			</td>
			<td class="value">
				<div>
					<a href="#$pieces_to_delete" class="anchor">#</a>
					<code></code>
				</div>
			</td>
		</tr>
			</table>
		</div>


		<div class="panel panel-default">
            <div class="panel-heading"><h3>Properties used from <a href="class-App.Lib.Traits.EditionStackCache.html#properties">App\Lib\Traits\EditionStackCache</a></h3></div>
			<p class="elementList">
				<code><a href="class-App.Lib.Traits.EditionStackCache.html#$configuration"><var>$configuration</var></a></code>
			</p>
		</div>




</div>
	</div>

	<div id="footer">
		StudioManagerScratch API documentation generated by <a href="http://apigen.org">ApiGen</a>
	</div>
</div>
<script src="resources/combined.js"></script>
<script src="elementlist.js"></script>
</body>
</html>
