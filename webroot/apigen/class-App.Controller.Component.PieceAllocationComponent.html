<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">

	<title>Class App\Controller\Component\PieceAllocationComponent | StudioManagerScratch</title>

	<link rel="stylesheet" href="resources/bootstrap.min.css?973e37a8502921d56bc02bb55321f45b072b6f71">
	<link rel="stylesheet" href="resources/style.css?49f43d3208c5d7e33fa16d36107a345bf11cc00d">

</head>

<body>
	<nav id="navigation" class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<a href="index.html" class="navbar-brand">StudioManagerScratch</a>
			</div>
			<div class="collapse navbar-collapse">

                <form id="search" class="navbar-form navbar-left" role="search">
                    <input type="hidden" name="cx" value="">
                    <input type="hidden" name="ie" value="UTF-8">
                    <div class="form-group">
                        <input type="text" name="q" class="search-query form-control" placeholder="Search">
					</div>
				</form>

				<ul class="nav navbar-nav">
					<li>
						<a href="namespace-App.Controller.Component.html" title="Summary of App\Controller\Component"><span>Namespace</span></a>
					</li>
					<li class="active">
<span>Class</span>					</li>

					<li class="divider-vertical"></li>


						<li>
							<a href="annotation-group-todo.html" title="List of elements with todo annotation">
								<span>Todo</span>
							</a>
						</li>


				</ul>
			</div>
		</div>
	</nav>

	<div id="left">
	<div id="menu">

		<div id="groups">
				<h3>Namespaces</h3>
			<ul>
					<li class="active">
						<a href="namespace-App.html">
							App<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Cache.html">
							Cache						</a>
							</li>
					<li>
						<a href="namespace-App.Console.html">
							Console						</a>
							</li>
					<li class="active">
						<a href="namespace-App.Controller.html">
							Controller<span></span>
						</a>
							<ul>
					<li class="active">
						<a href="namespace-App.Controller.Component.html">
							Component						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Database.html">
							Database<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Database.Type.html">
							Type						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Exception.html">
							Exception						</a>
							</li>
					<li>
						<a href="namespace-App.Form.html">
							Form						</a>
							</li>
					<li>
						<a href="namespace-App.Lib.html">
							Lib<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Lib.Traits.html">
							Traits						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Model.html">
							Model<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Model.Behavior.html">
							Behavior						</a>
							</li>
					<li>
						<a href="namespace-App.Model.Entity.html">
							Entity<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.Model.Entity.EditionSubs.html">
							EditionSubs						</a>
							</li>
					<li>
						<a href="namespace-App.Model.Entity.Traits.html">
							Traits						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Model.Lib.html">
							Lib						</a>
							</li>
					<li>
						<a href="namespace-App.Model.Table.html">
							Table						</a>
							</li>
								</ul></li>
					<li>
						<a href="namespace-App.Shell.html">
							Shell						</a>
							</li>
					<li>
						<a href="namespace-App.SiteMetrics.html">
							SiteMetrics						</a>
							</li>
					<li>
						<a href="namespace-App.View.html">
							View<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.View.Cell.html">
							Cell						</a>
							</li>
					<li>
						<a href="namespace-App.View.Helper.html">
							Helper<span></span>
						</a>
							<ul>
					<li>
						<a href="namespace-App.View.Helper.Traits.html">
							Traits						</a>
							</li>
								</ul></li></ul></li></ul></li>
			</ul>
		</div>


		<div id="elements">
			<h3>Classes</h3>
			<ul>
				<li><a href="class-App.Controller.Component.ArtworkStackComponent.html">ArtworkStackComponent</a></li>
				<li><a href="class-App.Controller.Component.DispositionManagerComponent.html">DispositionManagerComponent</a></li>
				<li><a href="class-App.Controller.Component.EditionStackComponent.html">EditionStackComponent</a></li>
				<li><a href="class-App.Controller.Component.LayersComponent.html">LayersComponent</a></li>
				<li class="active"><a href="class-App.Controller.Component.PieceAllocationComponent.html">PieceAllocationComponent</a></li>
				<li><a href="class-App.Controller.Component.PieceAssignmentComponent.html">PieceAssignmentComponent</a></li>
			</ul>





		</div>
	</div>
</div>

<div id="splitter"></div>

<div id="right">
	<div id="rightInner">
<div id="content" class="class">
	<h1>Class PieceAllocationComponent</h1>


	<div class="description">
	<p>PieceAllocation Handles allocation/deletion of pieces during create/refine</p>

<p>The rules for piece management are too complex to include in the
Artwork Stack Component which manages Artwork CRUD tasks. So they've
all been delegated to this class.</p>

<p>Allocation of new pieces and deletion of existing pieces are processes that
are trigged by change to Editions->quantity. Both piece increase and decrease
are performed according to set rules and those rules are defined in this class.</p>

<p>Piece assignment and reassignment are user directed processes that
move pieces between an Edition layer and its Format layer(s).
That process is handled in the PieceAssignmentComponent.</p>
	</div>

	<dl class="tree well">
		<dd style="padding-left:0px">
Cake\Controller\Component
			
			
		</dd>
		<dd style="padding-left:30px">
			<img src="resources/inherit.png" alt="Extended by">
<b><span>App\Controller\Component\PieceAllocationComponent</span></b>			
			
			
		</dd>
	</dl>








	<div class="alert alert-info">
		
		
		<b>Namespace:</b> <a href="namespace-App.html">App</a>\<a href="namespace-App.Controller.html">Controller</a>\<a href="namespace-App.Controller.Component.html">Component</a><br>
		

				<b>Author:</b>
				dondrake<br>
				<b>Todo:</b>
				Make this handle custom numbering schemes (see notes in Range)<br>
				<b>Todo:</b>
				Make this handle user-defined finite numbering schemes (see notes in Range)<br>
			<b>Located at</b> <a href="source-class-App.Controller.Component.PieceAllocationComponent.html#10-341" title="Go to source code">Controller/Component/PieceAllocationComponent.php</a>
		<br>
	</div>



		<div class="panel panel-default">
			<div class="panel-heading"><h2>Methods summary</h2></div>
			<table class="summary table table-bordered table-striped methods" id="methods">
		<tr data-order="initialize" id="_initialize">

			<td class="attributes"><code>
				 public 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_initialize">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#44-60" title="Go to source code">initialize</a>( <span>array <var>$config</var> = <span class="php-keyword1">array</span>()</span> )</code>

			<div class="description short">
				<p>Build the required component internals</p>
			</div>

			<div class="description detailed hidden">
				<p>Build the required component internals</p>

<p>Makes controller, SystemState, and artwork available</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$config</var></dt>
						<dd></dd>
					</dl></div>


					<h4>Throws</h4>
					<div class="list">
						Exception<br>Requires and Artwork Entity
					</div>



			</div>
			</div></td>
		</tr>
		<tr data-order="allocate" id="_allocate">

			<td class="attributes"><code>
				 public 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_allocate">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#62-78" title="Go to source code">allocate</a>( )</code>

			<div class="description short">
				
			</div>

			<div class="description detailed hidden">
				





					<h4>Todo</h4>
					<div class="list">
							<p>Flagged as a serious issue:
    https://github.com/OrigamiStructures/StudioManagerScratch/issues/41</p><br>
					</div>


			</div>
			</div></td>
		</tr>
		<tr data-order="piecesToFormat" id="_piecesToFormat">

			<td class="attributes"><code>
				 protected 
				Entity
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_piecesToFormat">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#80-93" title="Go to source code">piecesToFormat</a>( <span>Entity <var>$piece</var> = <span class="php-keyword1">NULL</span></span> )</code>

			<div class="description short">
				<p>Move the single piece onto the last edited format</p>
			</div>

			<div class="description detailed hidden">
				<p>Move the single piece onto the last edited format</p>

<p>THIS SEEMS A BIT QUESTIONABLE. ONE PIECE? FORMAT ASSUMPTION...</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$piece</var></dt>
						<dd></dd>
					</dl></div>

					<h4>Returns</h4>
					<div class="list">
						Entity
					</div>




			</div>
			</div></td>
		</tr>
		<tr data-order="onePiece" id="_onePiece">

			<td class="attributes"><code>
				 protected 
				boolean
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_onePiece">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#95-102" title="Go to source code">onePiece</a>( )</code>

			<div class="description short">
				<p>Does the edition have only one piece?</p>
			</div>

			<div class="description detailed hidden">
				<p>Does the edition have only one piece?</p>



					<h4>Returns</h4>
					<div class="list">
						boolean
					</div>




			</div>
			</div></td>
		</tr>
		<tr data-order="refine" id="_refine">

			<td class="attributes"><code>
				 public 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_refine">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#104-124" title="Go to source code">refine</a>( <span>Entity <var>$data</var> = []</span>, <span>array <var>$quantity_tuple</var>,…</span> )</code>

			<div class="description short">
				<p>Handle edition size changes for editions that already have pieces</p>
			</div>

			<div class="description detailed hidden">
				<p>Handle edition size changes for editions that already have pieces</p>

<p>There is a lot of initialization that has been done. Many properties set</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$data</var></dt>
						<dd>$artwork The post-save entity</dd>
						<dt><var>$quantity_tuple</var>,…</dt>
						<dd>(int) $original, (int) $refinement, $id</dd>
					</dl></div>





			</div>
			</div></td>
		</tr>
		<tr data-order="resizeOpenEdition" id="_resizeOpenEdition">

			<td class="attributes"><code>
				 protected 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_resizeOpenEdition">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#126-155" title="Go to source code">resizeOpenEdition</a>( <span>integer <var>$original</var></span>, <span>integer <var>$change</var></span> )</code>

			<div class="description short">
				<p>Change the size of an Open edition</p>
			</div>

			<div class="description detailed hidden">
				<p>Change the size of an Open edition</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$original</var></dt>
						<dd></dd>
						<dt><var>$change</var></dt>
						<dd></dd>
					</dl></div>





			</div>
			</div></td>
		</tr>
		<tr data-order="resizeLimitedEdition" id="_resizeLimitedEdition">

			<td class="attributes"><code>
				 protected 
				type
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_resizeLimitedEdition">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#157-186" title="Go to source code">resizeLimitedEdition</a>( <span>integer <var>$original</var></span>, <span>signed-integer <var>$change</var></span> )</code>

			<div class="description short">
				<p>Change the size of a limited edition</p>
			</div>

			<div class="description detailed hidden">
				<p>Change the size of a limited edition</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$original</var></dt>
						<dd></dd>
						<dt><var>$change</var></dt>
						<dd></dd>
					</dl></div>

					<h4>Returns</h4>
					<div class="list">
						type
					</div>




			</div>
			</div></td>
		</tr>
		<tr data-order="increaseOpenEdition" id="_increaseOpenEdition">

			<td class="attributes"><code>
				 protected 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_increaseOpenEdition">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#188-244" title="Go to source code">increaseOpenEdition</a>( <span>integer <var>$change</var></span>, <span>entity <var>$piece</var></span> )</code>

			<div class="description short">
				<p>Add pieces to an existing Open edition type</p>
			</div>

			<div class="description detailed hidden">
				<p>Add pieces to an existing Open edition type</p>

<p>Open editions use the 'quantity' field of Piece entities, so if an
open edition has unassigned pieces, there will be one record for them.
Increasing the edition size requires changing the 'quantity' value
in that record or creating an unassigned piece record with the quantity</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$change</var></dt>
						<dd>Number of additional unassigned pieces needed</dd>
						<dt><var>$piece</var></dt>
						<dd>Entity, the unassigned piece record</dd>
					</dl></div>


					<h4>Throws</h4>
					<div class="list">
						CakeDC\Users\Exception\BadConfigurationException
					</div>



			</div>
			</div></td>
		</tr>
		<tr data-order="decreaseOpenEdition" id="_decreaseOpenEdition">

			<td class="attributes"><code>
				 protected 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_decreaseOpenEdition">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#246-288" title="Go to source code">decreaseOpenEdition</a>( <span>type <var>$change</var></span>, <span>type <var>$original_edition</var></span> )</code>

			<div class="description short">
				
			</div>

			<div class="description detailed hidden">
				


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$change</var></dt>
						<dd></dd>
						<dt><var>$original_edition</var></dt>
						<dd>$piece</dd>
					</dl></div>





			</div>
			</div></td>
		</tr>
		<tr data-order="increaseLimitedEdition" id="_increaseLimitedEdition">

			<td class="attributes"><code>
				 protected 
				
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_increaseLimitedEdition">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#290-320" title="Go to source code">increaseLimitedEdition</a>( <span>signed-int <var>$change</var></span> )</code>

			<div class="description short">
				<p>Increase the Limited Edition by some amount</p>
			</div>

			<div class="description detailed hidden">
				<p>Increase the Limited Edition by some amount</p>

<p>If there is only one format, put the new pieces directly on it.
Otherwise put them on the edition.</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$change</var></dt>
						<dd></dd>
					</dl></div>





			</div>
			</div></td>
		</tr>
		<tr data-order="decreaseLimitedEdition" id="_decreaseLimitedEdition">

			<td class="attributes"><code>
				 protected 
				array
				
				</code>
			</td>

			<td class="name"><div>
			<a class="anchor" href="#_decreaseLimitedEdition">#</a>
			<code><a href="source-class-App.Controller.Component.PieceAllocationComponent.html#322-339" title="Go to source code">decreaseLimitedEdition</a>( <span>signed-int <var>$change</var></span>, <span>Table <var>$pieces</var></span>, <span>entity <var>$original_edition</var></span> )</code>

			<div class="description short">
				<p>Get the pieces that should be removed from the edition</p>
			</div>

			<div class="description detailed hidden">
				<p>Get the pieces that should be removed from the edition</p>

<p>Numbered editions can only loose their tailing, undisposed pieces
even if those pieces are assigned to a format.</p>


					<h4>Parameters</h4>
					<div class="list"><dl>
						<dt><var>$change</var></dt>
						<dd></dd>
						<dt><var>$pieces</var></dt>
						<dd></dd>
						<dt><var>$original_edition</var></dt>
						<dd></dd>
					</dl></div>

					<h4>Returns</h4>
					<div class="list">
						array
					</div>




			</div>
			</div></td>
		</tr>
			</table>
		</div>











		<div class="panel panel-default">
            <div class="panel-heading"><h2>Properties summary</h2></div>
			<table class="summary table table-bordered table-striped properties" id="properties">
		<tr data-order="controller" id="$controller">
			<td class="attributes"><code>
				protected  
				
			</code></td>

			<td class="name">
					<a href="source-class-App.Controller.Component.PieceAllocationComponent.html#32" title="Go to source code"><var>$controller</var></a>

				<div class="description short">
					
				</div>

				<div class="description detailed hidden">
					

				</div>
			</td>
			<td class="value">
				<div>
					<a href="#$controller" class="anchor">#</a>
					<code></code>
				</div>
			</td>
		</tr>
		<tr data-order="SystemState" id="$SystemState">
			<td class="attributes"><code>
				protected  
				
			</code></td>

			<td class="name">
					<a href="source-class-App.Controller.Component.PieceAllocationComponent.html#33" title="Go to source code"><var>$SystemState</var></a>

				<div class="description short">
					
				</div>

				<div class="description detailed hidden">
					

				</div>
			</td>
			<td class="value">
				<div>
					<a href="#$SystemState" class="anchor">#</a>
					<code></code>
				</div>
			</td>
		</tr>
		<tr data-order="stack" id="$stack">
			<td class="attributes"><code>
				protected  
				
			</code></td>

			<td class="name">
					<a href="source-class-App.Controller.Component.PieceAllocationComponent.html#34" title="Go to source code"><var>$stack</var></a>

				<div class="description short">
					
				</div>

				<div class="description detailed hidden">
					

				</div>
			</td>
			<td class="value">
				<div>
					<a href="#$stack" class="anchor">#</a>
					<code></code>
				</div>
			</td>
		</tr>
		<tr data-order="artwork" id="$artwork">
			<td class="attributes"><code>
				protected  
				
			</code></td>

			<td class="name">
					<a href="source-class-App.Controller.Component.PieceAllocationComponent.html#35" title="Go to source code"><var>$artwork</var></a>

				<div class="description short">
					
				</div>

				<div class="description detailed hidden">
					

				</div>
			</td>
			<td class="value">
				<div>
					<a href="#$artwork" class="anchor">#</a>
					<code></code>
				</div>
			</td>
		</tr>
		<tr data-order="Artworks" id="$Artworks">
			<td class="attributes"><code>
				protected  
				
			</code></td>

			<td class="name">
					<a href="source-class-App.Controller.Component.PieceAllocationComponent.html#36" title="Go to source code"><var>$Artworks</var></a>

				<div class="description short">
					
				</div>

				<div class="description detailed hidden">
					

				</div>
			</td>
			<td class="value">
				<div>
					<a href="#$Artworks" class="anchor">#</a>
					<code></code>
				</div>
			</td>
		</tr>
			</table>
		</div>






</div>
	</div>

	<div id="footer">
		StudioManagerScratch API documentation generated by <a href="http://apigen.org">ApiGen</a>
	</div>
</div>
<script src="resources/combined.js"></script>
<script src="elementlist.js"></script>
</body>
</html>
